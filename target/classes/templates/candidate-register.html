<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<title th:text="${candidate.candidateId != null} ? 'Edit Candidate' : 'Candidate Registration'"></title>

	<!-- Bootstrap & Font Awesome CSS -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

	<!-- Custom CSS -->
	<style>
		/* ========================
		   General Reset & Styling
		======================== */
		* { box-sizing: border-box; }

		body {
			font-family: 'Segoe UI', sans-serif;
			background: url('https://images.pexels.com/photos/271624/pexels-photo-271624.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260') no-repeat center center/cover;
			height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			margin: 0;
		}

		/* ========================
		   Form Container
		======================== */
		.container {
			background: rgba(255, 255, 255, 0.15);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.3);
			border-radius: 18px;
			padding: 20px 25px;
			width: 95%;
			max-width: 880px;
			box-shadow: 0 6px 28px rgba(0, 0, 0, 0.2);
		}

		h3 {
			text-align: center;
			color: #4b0082;
			font-size: 22px;
			font-weight: bold;
			margin-bottom: 18px;
		}

		/* ========================
		   Form Rows & Groups
		======================== */
		.form-row {
			display: flex;
			justify-content: space-between;
			gap: 10px;
			flex-wrap: wrap;
			margin-bottom: 10px;
		}

		.form-group {
			flex: 1;
			min-width: 250px;
		}

		.form-group label {
			font-weight: 600;
			color: #000;
			font-size: 13px;
			margin-bottom: 5px;
			display: block;
		}

		.input-group-text {
			background-color: #ddd;
			border: none;
			border-radius: 8px 0 0 8px;
			font-size: 13px;
		}

		.form-control {
			border-radius: 0 8px 8px 0;
			border: none;
			padding: 8px 10px;
			font-size: 13px;
		}

		select.form-control {
			text-align: center;
			color: #555;
			height: 38px;
		}

		input[type="file"].form-control {
			padding: 5px 10px;
			background-color: #fff;
		}

		/* ========================
		   Buttons
		======================== */
		.button-group {
			display: flex;
			justify-content: flex-start;
			gap: 10px;
			margin-top: 15px;
		}

		.btn {
			padding: 8px 16px;
			border: none;
			border-radius: 8px;
			font-weight: bold;
			font-size: 13px;
			cursor: pointer;
			transition: background 0.3s;
			width: 120px;
		}

		.btn-save { background-color: #04AA6D; color: white; }
		.btn-save:hover { background-color: #03995f; }

		.btn-cancel { background-color: #f44336; color: white; }
		.btn-cancel:hover { background-color: #d7372d; }

		/* ========================
		   Responsive Adjustments
		======================== */
		@media (max-width: 768px) {
			.form-row { flex-direction: column; }
			.btn { width: 100%; }
			.button-group { flex-direction: column; align-items: stretch; }
		}
	</style>
</head>

<body>
	<div class="container">
		<!-- Form Title: Edit or Registration -->
		<h3 th:text="${candidate.candidateId != null} ? 'Edit Candidate' : 'Candidate Registration'"></h3>

		<!-- ========================
		     Candidate Form
		     enctype="multipart/form-data" required for file uploads
		======================== -->
		<form th:action="@{/candidates/save}" th:object="${candidate}" method="post" enctype="multipart/form-data">
			<input type="hidden" th:field="*{candidateId}" />

			<!-- Row 1: Name & Gender -->
			<div class="form-row">
				<div class="form-group">
					<label>Name:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-user"></i></span>
						<input class="form-control" th:field="*{name}" placeholder="Enter Candidate Name" required />
					</div>
				</div>
				<div class="form-group">
					<label>Gender:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
						<select class="form-control" th:field="*{gender}" required>
							<option value="">Select Gender</option>
							<option value="male">Male</option>
							<option value="female">Female</option>
							<option value="other">Other</option>
						</select>
					</div>
				</div>
			</div>

			<!-- Row 2: Age & Date of Birth -->
			<div class="form-row">
				<div class="form-group">
					<label>Age:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
						<!-- Restrict to 2 digits -->
						<input class="form-control" type="number" th:field="*{age}" min="0" max="99"
							oninput="this.value=this.value.slice(0,2)" required />
					</div>
				</div>
				<div class="form-group">
					<label>Date of Birth:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
						<input class="form-control" type="date" th:field="*{dob}" required />
					</div>
				</div>
			</div>

			<!-- Row 3: Mobile & Email -->
			<div class="form-row">
				<div class="form-group">
					<label>Mobile:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-phone"></i></span>
						<!-- Only 10 digits allowed -->
						<input class="form-control" th:field="*{mobile}" minlength="10" maxlength="10"
							inputmode="numeric" pattern="\d*" placeholder="Enter 10-digit Mobile Number"
							oninput="this.value=this.value.replace(/[^0-9]/g,'')" required />
					</div>
				</div>
				<div class="form-group">
					<label>Email:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-envelope"></i></span>
						<input class="form-control" type="email" placeholder="Enter Candidate Email" th:field="*{email}" required />
					</div>
				</div>
			</div>

			<!-- Row 4: Room No & Aadhaar -->
			<div class="form-row">
				<div class="form-group">
					<label>Room No:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-door-closed"></i></span>
						<input class="form-control" th:field="*{roomNo}" placeholder="Enter Candidate Room" required />
					</div>
				</div>
				<div class="form-group">
					<label>Aadhaar Number:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-id-card"></i></span>
						<!-- Auto-format as XXXX-XXXX-XXXX -->
						<input class="form-control" type="text" th:field="*{aadhaar}"
							placeholder="Enter Candidate 12 Digits Aadhar Number" maxlength="14"
							oninput="this.value=this.value.replace(/[^0-9]/g,'').replace(/(.{4})/g,'$1-').replace(/-$/,'').slice(0,14);"
							required />
					</div>
				</div>
			</div>

			<!-- Row 5: Joining Date & Guardian Mobile -->
			<div class="form-row">
				<div class="form-group">
					<label>Joining Date:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
						<input class="form-control" type="date" 
							   name="joiningDate"
							   th:value="${candidate.joiningDate != null ? #dates.format(candidate.joiningDate, 'yyyy-MM-dd') : #dates.format(#dates.createNow(), 'yyyy-MM-dd')}" 
							   th:attr="max=${maxDate}" required />
					</div>
				</div>
				<div class="form-group">
					<label>Guardian Mobile:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-user-shield"></i></span>
						<input class="form-control" th:field="*{guardianMobile}" maxlength="10"
							oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,10);" required />
					</div>
				</div>
			</div>

			<!-- Row 6: Select PG -->
			<div class="form-row">
				<div class="form-group">
					<label>Select PG:</label>
					<select id="pgSelect" class="form-control" name="selectedPgId" required>
						<option value="" selected disabled>-- Select PG --</option>
						<option th:each="pg : ${pgs}" th:value="${pg.id}" th:text="${pg.pgName}"
							th:selected="${pg.id == selectedPgId}"></option>
					</select>
				</div>
			</div>

			<!-- Row 7: Upload Photo & ID Proof -->
			<div class="form-row">
				<div class="form-group">
					<label>Upload Photo:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-camera"></i></span>
						<input type="file" class="form-control" name="photoFile" accept="image/*" required />
					</div>
				</div>
				<div class="form-group">
					<label>Upload ID Proof:</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-id-card"></i></span>
						<input type="file" class="form-control" name="idProofFile" accept="image/*,application/pdf" required />
					</div>
				</div>
			</div>

			<!-- Form Buttons -->
			<div class="button-group">
				<button type="submit" class="btn btn-save"><i class="fas fa-save"></i> Save</button>
				<a id="cancelBtn" th:href="@{/candidates/list(pgId=${selectedPgId})}" class="btn btn-cancel">
					<i class="fas fa-times-circle"></i> Cancel
				</a>
			</div>
		</form>
	</div>

	<!-- jQuery & Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

	<!-- Update Cancel Button Link Dynamically -->
	<script th:inline="javascript">
		const pgSelect = document.getElementById('pgSelect');
		const cancelBtn = document.getElementById('cancelBtn');

		// Server-side PG ID passed for default cancel link
		const serverPgId = /*[[${pgId != null ? pgId : (selectedPgId != null ? selectedPgId : null)}]]*/ null;

		function updateCancelLink() {
			let pgId = null;

			// 1. Use selected PG from dropdown if available
			if (pgSelect && pgSelect.value) pgId = pgSelect.value;
			// 2. Otherwise use server-side PG ID
			else if (serverPgId) pgId = serverPgId;

			// 3. Update Cancel link
			cancelBtn.href = pgId ? '/candidates/list?pgId=' + pgId : '/candidates/list';
		}

		// Initialize cancel link on page load
		updateCancelLink();

		// Update cancel link when PG dropdown changes
		if (pgSelect) {
			pgSelect.addEventListener('change', updateCancelLink);
		}
	</script>
</body>
</html>
