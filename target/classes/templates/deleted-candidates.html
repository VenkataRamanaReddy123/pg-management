<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Deleted Candidates</title>

	<!-- ========================= CSS LIBRARIES ========================= -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

	<style>
		/* ========================= GLOBAL FONT ========================= */
		body,
		.container,
		table,
		th,
		td,
		label,
		select,
		button,
		input,
		.modal,
		.form-control,
		.summary-box,
		h2,
		h5 {
			font-family: 'Calibri', Tahoma, Verdana, sans-serif !important;
		}

		/* ========================= BODY & PAGE LAYOUT ========================= */
		body {
			background-color: #e9ecef;
			overflow-x: hidden;
			padding: 20px 0;
		}

		.container {
			background: white;
			padding: 25px 30px;
			border-radius: 14px;
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
			max-width: 95vw;
		}

		h2 {
			text-align: center;
			font-weight: 700;
			margin-bottom: 25px;
			letter-spacing: .5px;
		}

		/* ========================= FILTER BAR ========================= */
		.search-section {
			display: flex;
			align-items: flex-end;
			justify-content: space-between;
			background-color: #dff6fa;
			padding: 15px;
			border-radius: 10px;
			margin-bottom: 18px;
			gap: 18px;
		}

		select.form-control {
			height: 38px;
			border-radius: 6px;
		}

		.btn-success {
			background-color: #28a745 !important;
			border-radius: 6px;
			font-weight: 600;
		}

		/* ========================= SUMMARY BOX ========================= */
		.summary-box {
			padding: 10px 15px;
			background: #fff;
			border-radius: 8px;
			box-shadow: 0 0 6px rgba(0, 0, 0, 0.08);
			font-weight: 600;
			white-space: nowrap;
		}

		.summary-box span {
			color: red;
			font-weight: 700;
		}

		/* ========================= TABLE STYLES ========================= */
		table {
			width: 100%;
			border-radius: 8px;
			overflow: hidden;
			text-align: center;
		}

		thead th {
			background-color: #007b7f;
			color: #fff;
			white-space: nowrap;
			font-weight: 700;
		}

		td {
			padding: 8px;
		}

		/* Row colors by gender */
		.male-row {
			background-color: #c8e6c9 !important;
		}

		.female-row {
			background-color: #f8bcbc !important;
		}

		/* ========================= FOOTER / BOTTOM BUTTONS ========================= */
		.bottom-buttons a {
			width: 200px;
			padding: 10px 18px;
			border-radius: 8px;
			font-weight: 700;
			margin: 0 8px;
		}

		/* ========================= IMAGE MODAL ========================= */
		.modal-img {
			max-width: 100%;
			max-height: 75vh;
			display: block;
			margin: auto;
			border-radius: 10px;
		}

		.toolbar-btn {
			font-size: 18px;
			padding: 8px 12px;
			cursor: pointer;
			margin-right: 8px;
			color: #444;
		}

		.toolbar-btn:hover {
			color: #000;
		}

		/* Button default styles */
		button,
		.btn {
			font-size: 15px;
			font-weight: 600;
			border-radius: 6px;
		}

		.top-action-buttons {
			display: flex;
			justify-content: flex-end;
			gap: 8px;
		}

		.top-action-buttons .btn {
			font-size: 13px;
			padding: 4px 8px;
			font-weight: 600;
			border-radius: 6px;
		}

		/* Small rounded buttons with icons */
		.custom-btn {
			border-radius: 6px;
			font-weight: 600;
			height: 38px;
			padding: 0 12px;
			display: inline-flex;
			align-items: center;
		}

		.custom-btn i {
			margin-right: 5px;
		}

		.btn-spacing {
			margin-right: 11px;
		}

	</style>
</head>

<body>

	<div class="container">

		<!-- ========================= PAGE TITLE ========================= -->
		<h2 class="page-title">
			Deleted Candidates
			<!-- Show PG name if selected -->
			<span th:if="${pgName != null}">
				<span th:text="' - ' + ${pgName}" style="color:#007bff; font-weight:700;"></span>
			</span>
		</h2>

		<!-- ========================= TOP ACTION BUTTONS ========================= -->
		<div class="d-flex align-items-center w-100 mb-3">
			<!-- Left buttons -->
			<div class="d-flex align-items-center">
				<!-- Back to candidates button if a PG is selected -->
				<a th:if="${selectedPgId != null}" th:href="@{/candidates/list(pgId=${selectedPgId})}" class="btn btn-success btn-sm btn-spacing">
					Candidates
				</a>
				<!-- PG list button -->
				<a href="/pgs/list" class="btn btn-success btn-sm">
					<i class="bi bi-house-door-fill me-1"></i> PG List
				</a>
			</div>

			<!-- Spacer pushes logout to right -->
			<div class="flex-grow-1"></div>

			<!-- Logout button -->
			<form th:action="@{/logout}" method="get" style="margin:0;">
				<button type="submit" class="btn btn-outline-danger btn-sm" title="Logout">
					<i class="fas fa-sign-out-alt"></i> Logout
				</button>
			</form>
		</div>

		<!-- ========================= FILTER FORM ========================= -->
		<form method="get" th:action="@{/candidates/deleted}">
			<div class="search-section">

				<!-- PG Selection -->
				<div style="display:flex; align-items:center; gap:10px;">
					<label class="form-label" style="margin:0; white-space:nowrap;">Select PG:</label>
					<select class="form-control" name="pgId" style="min-width:220px;">
						<option th:each="pg : ${allPgs}" th:value="${pg.id}" th:selected="${pg.id == selectedPgId}" th:text="${pg.pgName}"></option>
					</select>
				</div>

				<!-- Filter Button -->
				<div>
					<button class="btn btn-success" style="white-space:nowrap;">Filter</button>
				</div>

				<!-- Total Deleted Summary -->
				<div style="flex: 1; display: flex; justify-content: flex-end; align-items: center;">
					<div class="summary-box">
						Total Deleted Candidates:
						<span th:text="${totalDeleted}">0</span>
					</div>
				</div>

			</div>
		</form>

		<!-- ========================= TABLE ========================= -->
		<div class="table-responsive">
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>Name</th>
						<th>Gender</th>
						<th>Mobile</th>
						<th>Email</th>
						<th>Room No</th>
						<th>PG</th>
						<th>Aadhaar</th>
						<th>ID Proofs</th>
						<th>Deleted At</th>
					</tr>
				</thead>

				<tbody>
					<!-- Iterate deleted candidates -->
					<tr th:each="c : ${deletedCandidates}" th:classappend="${c.gender.toLowerCase() == 'male'} ? 'male-row' : (${c.gender.toLowerCase() == 'female'} ? 'female-row' : '')">
						<td th:text="${c.name}"></td>
						<td th:text="${c.gender}"></td>
						<td th:text="${c.mobile}"></td>
						<td th:text="${c.email}"></td>
						<td th:text="${c.roomNo}"></td>
						<td th:text="${c.pg.pgName}"></td>
						<td th:text="${c.aadhaar}"></td>

						<!-- Proof Buttons -->
						<td>
							<!-- Photo button if exists -->
							<button th:if="${c.photo != null}" class="btn btn-success btn-sm mx-1 custom-btn"
								th:onclick="'openImageModal(\'/candidates/deleted/photo/' + ${c.id} + '\')'">
								<i class="fas fa-camera"></i> Photo
							</button>

							<!-- ID Proof button if exists -->
							<button th:if="${c.idProof != null}" class="btn btn-success btn-sm mx-1"
								th:onclick="'openImageModal(\'/candidates/deleted/idProof/' + ${c.id} + '\')'">
								<i class="fas fa-id-card"></i> ID Proof
							</button>

							<!-- No proofs available -->
							<span th:if="${c.photo == null and c.idProof == null}" class="text-muted">No Proofs</span>
						</td>

						<!-- Deleted Date -->
						<td th:text="${c.deletedAt != null ? c.deletedAt.format(T(java.time.format.DateTimeFormatter).ofPattern('dd-MM-yyyy HH:mm')) : ''}"></td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- ========================= FOOTER BUTTONS ========================= -->
		<div class="text-center bottom-buttons mt-4">
			<a th:if="${selectedPgId != null}" th:href="@{/candidates/list(pgId=${selectedPgId})}" class="btn btn-success mx-2">Back to Candidates</a>
			<a href="/pgs/list" class="btn btn-success mx-2">Back to PG List</a>
		</div>

	</div>

	<!-- ========================= IMAGE MODAL ========================= -->
	<div class="modal fade" id="imageModal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">

				<!-- Modal Header with toolbar buttons -->
				<div class="modal-header">
					<div>
						<i class="fas fa-search-plus toolbar-btn" onclick="zoomIn()"></i>
						<i class="fas fa-search-minus toolbar-btn" onclick="zoomOut()"></i>
						<i class="fas fa-sync-alt toolbar-btn" onclick="rotateImage()"></i>
						<i class="fas fa-expand toolbar-btn" onclick="toggleFullscreen()"></i>
						<a id="downloadBtn" download><i class="fas fa-download toolbar-btn"></i></a>
					</div>
					<!-- Close modal -->
					<span class="close" data-dismiss="modal" style="font-size:32px; cursor:pointer;">&times;</span>
				</div>

				<!-- Modal Body with Image -->
				<div class="modal-body text-center">
					<img id="modalImage" class="modal-img" src="">
				</div>

			</div>
		</div>
	</div>

	<!-- ========================= SCRIPTS ========================= -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

	<script>
		// ========================= IMAGE MODAL LOGIC =========================
		let zoomLevel = 1;   // Current zoom scale
		let rotation = 0;    // Current rotation in degrees

		// Open modal with selected image
		function openImageModal(url) {
			const img = document.getElementById("modalImage");
			img.src = url;
			document.getElementById("downloadBtn").href = url;

			zoomLevel = 1;
			rotation = 0;
			img.style.transform = "scale(1) rotate(0deg)";

			$('#imageModal').modal('show');
		}

		// Zoom in image
		function zoomIn() {
			zoomLevel += 0.1;
			updateTransform();
		}

		// Zoom out image
		function zoomOut() {
			if (zoomLevel > 0.2) zoomLevel -= 0.1;
			updateTransform();
		}

		// Rotate image 90 degrees clockwise
		function rotateImage() {
			rotation += 90;
			updateTransform();
		}

		// Apply zoom and rotation transform
		function updateTransform() {
			document.getElementById("modalImage").style.transform =
				"scale(" + zoomLevel + ") rotate(" + rotation + "deg)";
		}

		// Toggle fullscreen mode for modal image
		function toggleFullscreen() {
			let modalImg = document.getElementById("modalImage");
			if (modalImg.requestFullscreen) modalImg.requestFullscreen();
		}
	</script>

</body>

</html>
